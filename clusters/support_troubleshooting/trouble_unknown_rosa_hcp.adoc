[#trouble-state-unknown-rosa-hcp]
= Troubleshooting all managed clusters become `Unknown` on a ROSA with hosted control planes cluster

On a Red Hat OpenShift Service on AWS (ROSA) with hosted control planes cluster, the state of all managed clusters might switch to `Unknown`.

[#symptom-state-unknown-rosa-hcp]
== Symptom: All managed clusters become `Unknown` on a ROSA with hosted control planes cluster

The state of all managed cluster on a ROSA hosted cluster suddenly becomes `Unknown`. When you check the `klusterlet-agent` pod log in the `open-cluster-management-agent` namespace on your managed cluster, you see the following error message: 

[source,bash]
----
E0809 18:45:29.450874       1 reflector.go:147] k8s.io/client-go@v0.29.4/tools/cache/reflector.go:229: Failed to watch *v1.CertificateSigningRequest: failed to list *v1.CertificateSigningRequest: Get "https://api.xxx.openshiftapps.com:443/apis/certificates.k8s.io/v1/certificatesigningrequests?limit=500&resourceVersion=0": tls: failed to verify certificate: x509: certificate signed by unknown authority
----

[#resolve-state-unknown-rosa-hcp]
== Resolving the problem: All managed clusters become `Unknown` on a ROSA with hosted control planes cluster

To resolve the problem, add the `ISRG Root X1` certificate to the klusterlet CA bundle by completing the following steps:

. Download and encode the root CA certificate by running the following command:

+
[source,bash]
----
curl -s https://letsencrypt.org/certs/isrgrootx1.pem | base64 | tr -d "\n"
----

. Create a `KlusterletConfig` resource and add your encoded CA certificate to the `spec` parameter section. See the following example:

+
[source,yaml]
----
apiVersion: config.open-cluster-management.io/v1alpha1
kind: KlusterletConfig
metadata:
  name: isrg-root-x1-ca
spec:
  hubKubeAPIServerCABundle: "<your_ca_certificate>"
----

. Apply the resource by running the following command on the hub cluster:

+
[source,bash]
----
oc apply -f <filename>
----

. Annotate your managed cluster by running the following command on the hub cluster. Replace values where needed:

+
[source,bash]
----
oc annotate --overwrite managedcluster <cluster_name> agent.open-cluster-management.io/klusterlet-config='isrg-root-x1-ca'
----
+
The state of some managed clusters might recover.

. For managed clusters that remain `Unknown`, export and decode the `import.yaml` file from the hub cluster by running the following command on the hub cluster. Replace values where needed:

+
[source,bash]
----
oc get secret <cluster_name>-import -n <cluster_name> -o jsonpath={.data.import/.yaml} | base64 --decode > <cluster_name>-import.yaml
----

. Apply the file by running the following command on the managed cluster. Replace values where needed:

+
[source,bash]
----
oc apply -f <cluster_name>-import.yaml
----

. For new {acm} hub clusters only, add the following annotation to the `ManagedCluster` resource:

[source,yaml]
----
annotations:
  agent.open-cluster-management.io/klusterlet-config: isrg-root-x1-ca
----
