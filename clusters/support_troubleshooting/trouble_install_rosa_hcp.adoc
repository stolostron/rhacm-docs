[#trouble-install-stuck-rosa-hcp]
= Troubleshooting installation status stuck at `Installing` on a ROSA with hosted control planes cluster

When you install {mce} on a Red Hat OpenShift Service on AWS (ROSA) with hosted control planes cluster, {mce-short} becomes stuck at the `Installing` step and the `local-cluster` remains in the `Unknown` state.

[#symptom-install-stuck-rosa-hcp]
== Symptom: Installation status stuck at `Installing` on a ROSA with hosted control planes cluster

The `local-cluster` remains in the `Unknown` state 10 minutes after installing {mce-short}. When you check the `klusterlet-agent` pod log in the `open-cluster-management-agent` namespace on your hub cluster, you see an error that resembles the following: 

[source,bash]
----
E0809 18:45:29.450874       1 reflector.go:147] k8s.io/client-go@v0.29.4/tools/cache/reflector.go:229: Failed to watch *v1.CertificateSigningRequest: failed to list *v1.CertificateSigningRequest: Get "https://api.xxx.openshiftapps.com:443/apis/certificates.k8s.io/v1/certificatesigningrequests?limit=500&resourceVersion=0": tls: failed to verify certificate: x509: certificate signed by unknown authority
----

[#resolve-install-stuck-rosa-hcp]
== Resolving the problem: Installation status stuck at `Installing` on a ROSA with hosted control planes cluster

To resolve the problem, add the `ISRG Root X1` certificate to the klusterlet CA bundle by completing the following steps:

. Download and encode the root CA certificate by running the following command:

+
[source,bash]
----
curl -s https://letsencrypt.org/certs/isrgrootx1.pem | base64 | tr -d "\n"
----

. Create a `KlusterletConfig` resource and add your encoded CA certificate to the `spec` parameter section. See the following example:

+
[source,yaml]
----
apiVersion: config.open-cluster-management.io/v1alpha1
kind: KlusterletConfig
metadata:
  name: isrg-root-x1-ca
spec:
  hubKubeAPIServerCABundle: "<your_ca_certificate>"
----

. Apply the resource by running the following command on the hub cluster:

+
[source,bash]
----
oc apply -f <filename>
----

. Annotate your managed cluster by running the following command on the hub cluster:

+
[source,bash]
----
oc annotate --overwrite managedcluster local-cluster agent.open-cluster-management.io/klusterlet-config='isrg-root-x1-ca'
----

. If the `local-cluster` state does not recover in 1 minute, export and decode the `import.yaml` file by running the following command on the hub cluster:

+
[source,bash]
----
oc get secret local-cluster-import -n local-cluster -o jsonpath={.data.import/.yaml} | base64 --decode > import.yaml
----

. Apply the file by running the following command on the hub cluster:

+
[source,bash]
----
oc apply -f import.yaml
----

. For new clusters only, add the following annotation to the `ManagedCluster` resource:

[source,yaml]
----
annotations:
  agent.open-cluster-management.io/klusterlet-config: isrg-root-x1-ca
----
