[#managedclustersets]
= Creating and managing ManagedClusterSets (Technology Preview)

// add prereq for users to managed cluster and managed cluster set 

A `ManagedClusterSet` is a group of managed clusters. With a managed cluster set, you can manage access to all of the managed clusters in the group together. You can also create a `ManagedClusterSetBinding` resource to bind a `ManagedClusterSet` resource to a namespace. 

* <<creating-a-managedclusterset,Creating a ManagedClusterSet>>
** <<creating-a-managedclusterset-console,Creating a ManagedClusterSet by using the console>>
** <<creating-a-managedclusterset-cli,Creating a ManagedClusterSet by using the command line>>
* <<adding-clusters-to-a-managedclusterset,Adding clusters to a ManagedClusterSet>>
** <<adding-clusters-to-a-managedclusterset-console,Adding clusters to a ManagedClusterSet by using the console>>
** <<adding-clusters-to-a-managedclusterset-cli,Adding clusters to a ManagedClusterSet by using the command line>>
* <<removing-a-managed-cluster-from-a-managedclusterset,Removing a managed cluster from a ManagedClusterSet>>
** <<removing-a-managed-cluster-from-a-managedclusterset-console,Removing a managed cluster from a ManagedClusterSet by using the console>>
** <<removing-clusters-from-a-managedclusterset-cli,Removing clusters from a ManagedClusterSet by using the command line>>
* <<creating-a-managedclustersetbinding,Creating a ManagedClusterSetBinding resource>>
** <<creating-a-managedclustersetbinding-console,Creating a ManagedClusterSetBinding by using the console>>
** <<creating-a-managedclustersetbinding-cli,Creating a ManagedClusterSetBinding by using the command line>>
* <<assign-role-clustersets,Assigning users or groups Role-Based Access Control permissions to your ManagedClusterSet>>

//* <<adding-users-to-managed-cluster-set,Adding users to a ManagedClusterSet>>
//* <<creating-cluster-pools,Creating cluster pools>>
//* <<use-cluster-pools-to-provision-clusters
// Comment from Brandi--with move to modular docs, the rest of the team has not been creating long topics with mutliple tasks. These should be broken out, no?


[#creating-a-managedclusterset]
== Creating a ManagedClusterSet

You can group managed clusters together in a managed cluster set to limit the user access on managed clusters.  

*Required access*: Cluster administrator

A `ManagedClusterSet` is a cluster-scoped resource, so you must have cluster administration permissions for the cluster where you are creating the `ManagedClusterSet`. A managed cluster cannot be included in more than one `ManagedClusterSet`. You can create a managed cluster set from either the {product-title} console or from the command-line interface.

[#creating-a-managedclusterset-console]
=== Creating a _ManagedClusterSet_ by using the console

Complete the following steps to create a managed cluster set by using the {product-title-short} console:
 
. In the main console navigation, select *Infrastructure* > *Clusters*.

. Select the _Cluster sets_ tab.

. Select *Create cluster set*.

. Enter the name of the cluster set that you want to create.

. Select *Create* to create the cluster set resource.

[#creating-a-managedclusterset-cli]
=== Creating a _ManagedClusterSet_ by using the command line

Add the following definition of the managed cluster set to your `yaml` file to create a managed cluster set by using the command line:

----
apiVersion: cluster.open-cluster-management.io/v1alpha1
kind: ManagedClusterSet
metadata:
  name: <clusterset1>
----

Replace `clusterset1` with the name of your managed cluster set. 

[#adding-clusters-to-a-managedclusterset]
== Adding clusters to a _ManagedClusterSet_
//possibly part of scenario 2, but still need to add info about creating a cluster

After you create your `ManagedClusterSet`, you must add one or more managed clusters. You can add managed clusters to your managed cluster set by using either the console or the command line.

[#adding-clusters-to-a-managedclusterset-console]
=== Adding clusters to a _ManagedClusterSet_ by using the console

Complete the following steps to add a cluster to a managed cluster set by using the {product-title-short} console:

. If you just created your managed cluster set, select *Manage resource assignments* to go directly to the _Manage resource assignments_ page. Continue with step 6 of this procedure. 

. If your cluster already exists, access the cluster page by selecting *Infrastructure* > *Clusters* in the main navigation.

. Select the *Cluster sets* tab to view the available cluster sets. 

. Select the name of the cluster set that you want to add to the managed cluster sets to view the cluster set details.

. Select *Actions* > *Manage resource assignments*.

. On the _Manage resource assignments_ page, select the checkbox for the resources that you want to add to the cluster set. 

. Select *Review* to review your changes. 

. Select *Save* to save your changes. 
+
*Note:* If you move a managed cluster from one managed cluster set to another, you must have the required RBAC permission available on both managed cluster sets.  

[#adding-clusters-to-a-managedclusterset-cli]
=== Adding clusters to a _ManagedClusterSet_ by using the command line

Complete the following steps to add a cluster to a managed cluster set by using the command line:

. Ensure that there is an RBAC `ClusterRole` entry that allows you to create on a virtual subresource of `managedclustersets/join`. Without this permission, you cannot assign a managed cluster to a `ManagedClusterSet`. 
+
If this entry does not exist, add it to your `yaml` file. A sample entry resembles the following content:
+
----
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: clusterrole1
rules:
  - apiGroups: ["cluster.open-cluster-management.io"]
    resources: ["managedclustersets/join"]
    resourceNames: ["<clusterset1>"]
    verbs: ["create"]
----
+
Replace `clusterset1` with the name of your `ManagedClusterSet`.
+
*Note:* If you are moving a managed cluster from one `ManagedClusterSet` to another, you must have that permission available on both managed cluster sets. 

. Find the definition of the managed cluster in the `yaml` file. The section of the managed cluster definition where you add a label resembles the following content:
+
----
apiVersion: cluster.open-cluster-management.io/v1
kind: ManagedCluster
metadata:
  name: cluster1
spec:
  hubAcceptsClient: true 
----
+
In this example, `cluster1` is the name of the managed cluster.

. Add a label that specifies the name of the `ManagedClusterSet` in the format: `cluster.open-cluster-management.io/clusterset: clusterset1`.
+
Your code resembles the following example:
+
----
apiVersion: cluster.open-cluster-management.io/v1
kind: ManagedCluster
metadata:
  name: cluster1
  labels:
    cluster.open-cluster-management.io/clusterset: clusterset1
spec:
  hubAcceptsClient: true
----
+
In this example, `cluster1` is the cluster that is added to the managed cluster set names `clusterset1`.
+
*Note:* If the managed cluster was previously assigned to a managed cluster set that was deleted, the managed cluster might have a managed cluster set already specified to a cluster set that does not exist. If so, replace the name with the new one.

[#removing-a-managed-cluster-from-a-managedclusterset]
== Removing a managed cluster from a _ManagedClusterSet_

You might want to remove a managed cluster from a managed cluster set to move it to a different managed cluster set, or remove it from the management settings of the set. You can remove a managed cluster from a managed cluster set by using the console or the command-line interface. 

[#removing-a-managed-cluster-from-a-managedclusterset-console]
=== Removing a managed cluster from a _ManagedClusterSet_ by using the console

Complete the following steps to remove a cluster from a managed cluster set by using the {product-title-short} console:

. If you just created your managed cluster set, select *Manage resource assignments* to go directly to the _Manage resource assignments_ page. Continue with step 6 of this procedure. 

. If your cluster already exists, access the cluster page by selecting *Infrastructure* > *Clusters* in the main navigation.

. Select the _Cluster sets_ tab to view the available cluster sets. 

. Select the name of the cluster set that you want to remove from the managed cluster set to view the cluster set details.

. Select *Actions* > *Manage resource assignments*.

. On the _Manage resource assignments_ page, select the checkbox for the resources that you want to remove from the cluster set. 
+
This step removes a resource that is already a member of the cluster set, or adds a resource that is not already a member of the cluster set. You can see if the resource is already a member of a cluster set by viewing the details of the managed cluster.   

. Select `Review` and review your changes, then select `Save`.

**Note**: If you are moving a managed cluster from one managed cluster set to another, you must have the required RBAC permissions on both managed cluster sets.

[#removing-clusters-from-a-managedclusterset-cli]
=== Removing clusters from a _ManagedClusterSet_ by using the command line

To remove a managed cluster from a managed cluster set by using the command line, complete the following steps:

. Run the following command to display a list of managed clusters in the managed cluster set:
+
----
oc get managedclusters -l cluster.open-cluster-management.io/clusterset=<clusterset1>
----
+
Replace `clusterset1` with the name of the managed cluster set.

. Locate the entry for the cluster that you want to remove.

. Remove the label from the the `yaml` entry for the cluster that you want to remove. See the following code for an example of the label:
+
----
labels:
   cluster.open-cluster-management.io/clusterset: clusterset1
----

*Note:* If you are moving a managed cluster from one managed cluster set to another, you must have the required RBAC permission available on both managed cluster sets.

[#creating-a-managedclustersetbinding]
== Creating a _ManagedClusterSetBinding_ resource

Create a `ManagedClusterSetBinding` resource to bind a `ManagedClusterSet` resource to a namespace. Application and policies that are created in the same namespace can only access managed clusters that are included in the bound managed cluster set resource. You can create a managed cluster set binding by using the console or the command line. 

[#creating-a-managedclustersetbinding-console]
=== Creating a _ManagedClusterSetBinding_ by using the console

Complete the following steps to remove a cluster from a managed cluster set by using the {product-title-short} console:

. Access the cluster page by selecting *Infrastructure* > *Clusters* in the main navigation.

. Select the _Cluster sets_ tab to view the available cluster sets. 

. Select the name of the cluster set that you want to create a binding for to view the cluster set details.

. Select *Actions* > *Edit namespace bindings*.

. On the _Edit namespace bindings_ page, select the namespace to which you want to bind the cluster set from the drop-down menu. The existing namespaces that have bindings to the cluster set are already selected. 

. Select *Save* to submit your changes.

[#creating-a-managedclustersetbinding-cli]
=== Creating a _ManagedClusterSetBinding_ by using the command line

To create a managed cluster set binding by using the command line, complete the following steps:

. Create the `ManagedClusterSetBinding` resource in your `yaml` file. When you create a managed cluster set binding, the name of the managed cluster set binding must match the name of the managed cluster set to bind. Your `ManagedClusterSetBinding` resource might resemble the following information:
+
----
apiVersion: cluster.open-cluster-management.io/v1alpha1
kind: ManagedClusterSetBinding
metadata:
  namespace: project1
  name: clusterset1
spec:
  clusterSet: clusterset1
----

. Ensure that you have the bind permission on the target managed cluster set. View the following example of a `ClusterRole` resource, which contains rules that allow the user to bind to `clusterset1`:
+
----
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: clusterrole1
rules:
  - apiGroups: ["cluster.open-cluster-management.io"]
    resources: ["managedclustersets/bind"]
    resourceNames: ["clusterset1"]
    verbs: ["create"]
----

[#assign-role-clustersets]
=== Assigning users or groups Role-Based Access Control permissions to your _ManagedClusterSet_

You can assign users or groups to your cluster set that are provided by the configured identity providers on the hub cluster.

*Required access:* Cluster administrator

The `ManagedClusterSet` API offers two levels of RBAC permissions:

* Cluster set `admin`
** Full access permissions to all of the cluster and cluster pool resources that are assigned to the managed cluster set.
** Permission to create clusters, import clusters, and create cluster pools. The permissions must be assigned to the managed cluster set when the managed cluster set is created.
* Cluster set `view`
** Read only permissions to all of the cluster and cluster pool resources that are assigned to the managed cluster set.
** No permission to create clusters, import clusters, or create cluster pools.

Complete the following steps to assign users or groups to your managed cluster set from the {product-title-short} console:

. From the main navigation menu of the console, select *Infrastructure* > *Clusters*.

. Select the _Cluster sets_ tab.

. Select your target cluster set. 

. Select the _Access management_ tab. 

. Select *Add user or group*.

. Search for, and select the user or group that you want to provide access.

. Select the *Cluster set admin* or *Cluster set view* role to give to the selected user or user group. See link:../access_control/rbac.adoc#overview-of-roles[Overview of roles] for more information about the role permissions.

. Select *Add* to submit the changes.

Your user or group is displayed in the table. It might take a few seconds for the permission assignments for all of the managed cluster set resources to be propagated to your user or group.

// 
//doc the association between clusterpool with clustersets, can provide access to create clusters in the pool and can help provide access to many users. Are there special roles for a clusterpool? 
//anyone bound to clusterset roles are able gain access to the clusterpools
// viewer can't create objects in a clusterpool 

For more information about role-based actions, see link:../access_control/rbac.adoc#role-based-access-control[Role-based access control].

See link:../clusters/placement_managed.adoc[Using ManagedClustersSets with Placement] for placement information.
