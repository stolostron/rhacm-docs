[#submariner]
= Submariner multicluster networking and service discovery

The _Submariner_ service is an open source tool that can be used with {product-title} to provide direct networking between pods across two or more Kubernetes clusters in your environment, either on-premises or in the cloud. For more information about Submariner, see the https://submariner.io/[Submariner website].

You can enable Submariner on {ocp-short} clusters that are hosted in the following environments:

* Amazon Web Services (AWS)
* Google Cloud Platform (GCP)
* IBM Cloud
* Microsoft Azure
* Red Hat OpenShift Dedicated
* VMware vSphere
* Bare metal
* Red Hat OpenStack Platform

{product-title} provides a Submariner component that you can deploy in your environment by using your hub cluster.

* <<submariner-prereq,Prerequisites>>
* xref:../submariner/submariner_prepare_hosts.adoc#preparing-selected-hosts-to-deploy-submariner[Preparing selected hosts for Submariner]
** xref:../submariner/submariner_prepare_hosts.adoc#preparing-azure[Preparing Microsoft Azure for Submariner]
** xref:../submariner/submariner_prepare_hosts.adoc#preparing-ibm[Preparing IBM Cloud for Submariner]
** xref:../submariner/submariner_prepare_hosts.adoc#preparing-vm[Preparing VMware vSphere for Submariner]
** xref:../submariner/submariner_prepare_hosts.adoc#preparing-bare[Preparing bare metal for Submariner]
** xref:../submariner/submariner_prepare_hosts.adoc#preparing-openstack[Preparing Red Hat OpenStack Platform for Submariner]

[#submariner-prereq]
== Prerequisites

Ensure that you have the following prerequisites before using Submariner:

* A {product-title-short} hub cluster that is running on {ocp} version 4.6, or later, with Kubernetes version 1.19, or later.
* A credential to access the hub cluster with `cluster-admin` permissions.
* Two or more {ocp-short} managed clusters that are running on {ocp-short} version 4.4, or later, with Kubernetes version 1.17, or later, and are managed by the {product-title-short} hub cluster.
* Non-overlapping pod and service Classless Inter-Domain Routing (CIDR) ranges for clusters. **Note:** The upstream feature called _Globalnet_ allows overlapping CIDRs, but it is not currently supported for use with {product-title-short}.
* IP connectivity must be configured between the Gateway nodes. When connecting two clusters, at least one of the clusters must be accessible to the Gateway node using its public or private IP address designated to the Gateway node. See https://submariner.io/operations/nat-traversal[Submariner NAT Traversal] for more information.
* Firewall configuration across all nodes in each of the managed clusters must allow 4800/UDP in both directions.
* Firewall configuration on the Gateway nodes must allow ingress 8080/TCP so the other nodes in the cluster can access it.
* Firewall configuration open for 4500/UDP and any other ports that are used for IPsec traffic on the gateway nodes.
+
*Note:* This is configured automatically when your clusters are deployed in an AWS or GCP environment, but must be configured manually for clusters on other environments and for the firewalls that protect private clouds.
+
.Submariner required ports
|===
| Name | Default value | Customizable

| IPsec NATT
| 4500/UDP
| Yes

| VXLAN
| 4800/UDP
| No

| Submariner metrics port
| 8080/TCP
| No
|===

See the https://submariner.io/getting-started/#prerequisites[Submariner upstream prerequisites documentation] for more detailed information about the prerequisites.

[#submariner-subctl]
== subctl command utility

Submariner contains the `subctl` utility that provides additional commands that simplify running tasks on your Submariner environment. 

[#Submariner-subctl-install]
=== Installing the subctl command utility

The `subctl` utility is shipped in a container image. Complete the following steps to install the `subctl` utility locally: 

. Download the `subctl` container and extract a compressed version of the `subctl` binary to `/tmp` by entering the following command: 
+
----
oc image extract registry-proxy.engineering.redhat.com/rh-osbs/rhacm2-tech-preview-subctl-rhel8:${VERSION} --path=/dist/subctl-${VERSION}-linux-amd64.tar.xz:/tmp/ --confirm
----

. Decompress the `subctl` utility by entering the following command: 
+
----
tar -C /tmp/ -xf /tmp/subctl-${VERSION}-linux-amd64.tar.xz
----

. Install the `subctl` utility by entering the following command:
+
----
install -m744 /tmp/subctl-${VERSION}/subctl-${VERSION}-linux-amd64 /$HOME/.local/bin/subctl
----

[#Submariner-subctl-command]
=== Using the subctl commands

After adding the utility to your path, the following table briefly describes the available commands:
//This is a dangling modifier. The table doesn't go to describe something after the understood "you" adds a utility. The subject doesn't agree here. Keep the action on the subject after you insert the comma to avoid these. --bcs

|===
| https://submariner.io/operations/deployment/subctl/#export-service[`export service`] | Creates a `ServiceExport` resource for the specified service, which enables other clusters in the Submariner deployment to discover the corresponding service. 
| https://submariner.io/operations/deployment/subctl/#unexport-service[`unexport service`] | Removes the `ServiceExport` resource for the specified service, which prevents other clusters in the Submariner deployment from discovering the corresponding service. 
| https://submariner.io/operations/deployment/subctl/#show[`show`] | Provides information about Submariner resources.
| https://submariner.io/operations/deployment/subctl/#verify[`verify`] | Verifies connectivity, service discovery, and other Submariner features when Submariner is configured across a pair of clusters.
| https://submariner.io/operations/deployment/subctl/#benchmark[`benchmark`] | Benchmarks throughput and latency across a pair of clusters that are enabled with Submariner or within a single cluster. 
| https://submariner.io/operations/deployment/subctl/#diagnose[`diagnose`] | Runs checks to identify issues that prevent the Submariner deployment from working correctly. 
| https://submariner.io/operations/deployment/subctl/#gather[`gather`] | Collects information from the clusters to help troubleshoot a Submariner deployment.
| https://submariner.io/operations/deployment/subctl/#version[`version`] | Displays the version details of the `subctl` binary tool.
|===
//This is an example of a verticle table versus the tables based on the ascii changes. We will need to decide which to continue with but the majority is the vertical input for the same output. It's best to see the rest of the doc and all of us to have a source that looks the same. We can see what the ascii guide at Red Hat asks for. Please always start with our source to create new content. --bcs

For more information about the `subctl` utility and its commands, see https://submariner.io/operations/deployment/subctl/[SUBCTL] in the Submariner documentation. 
