[#cert-manage]
= Managing certificates

Continue reading for information on how to refresh, replace, rotate, and list certificates.

- <<refresh-an-acm-webhook,Refreshing a {product-title-short} webhook certificate>>
- <<replacing-cert-alertmanager,Replacing certificates for alertmanager route>>
- <<rotating-the-gatekeeper-webhook-certificate,Rotating the gatekeeper webhook certificate>>
- <<list-hub-cluster-managed-certificates,Listing hub cluster managed certificates>>

[#refresh-an-acm-webhook]
== Refreshing a {product-title-short} webhook certificate

You can refresh {product-title-short} managed certificates, which are certificates that are created and managed by {product-title-short} services. 

Complete the following steps to refresh certificates managed by {product-title-short}:

. Delete the secret that is associated with the {product-title-short} managed certificate by running the following command:
+
----
oc delete secret -n <namespace> <secret> <1>
----
+
<1> Replace `<namespace>` and `<secret>` with the values that you want to use.

. Restart the services that are associated with the {product-title-short} managed certificate(s) by running the following command:
+
----
oc delete pod -n <namespace> -l <pod-label> <1>
----
+
<1> Replace `<namespace>` and `<pod-label>` with the values from the _{product-title-short} managed cluster certificates_ table.
+
*Note:* If a `pod-label` is not specified, there is no service that must be restarted. The secret is recreated and used automatically.

[#replacing-cert-alertmanager]
== Replacing certificates for alertmanager route

You can replace alertmanager certificates by updating the alertmanager route, if you do not want to use the OpenShift default ingress certificate. Complete the following steps:

. Examine the observability certificate with the following command:
+
----
openssl x509  -noout -text -in ./observability.crt
----

. Change the common name (`CN`) on the certificate to `alertmanager`.

. Change the SAN in the `csr.cnf` configuration file with the hostname for your alertmanager route.

. Create the two following secrets in the `open-cluster-management-observability` namespace. Run the following commands:
+
----
oc -n open-cluster-management-observability create secret tls alertmanager-byo-ca --cert ./ca.crt --key ./ca.key

oc -n open-cluster-management-observability create secret tls alertmanager-byo-cert --cert ./ingress.crt --key ./ingress.key
----

[#rotating-the-gatekeeper-webhook-certificate]
== Rotating the gatekeeper webhook certificate
//we can maybe use this as rotating certificates and list the commands 
Complete the following steps to rotate the gatekeeper webhook certificate:

. Edit the secret that contains the certificate with the following command: 
+
----
oc edit secret -n openshift-gatekeeper-system gatekeeper-webhook-server-cert
----

. Delete the following content in the `data` section: `ca.crt`, `ca.key`, `tls.crt`, and `tls.key`.

. Restart the gatekeeper webhook service by deleting the `gatekeeper-controller-manager` pods with the following command:
+
----
oc delete pod -n openshift-gatekeeper-system -l control-plane=controller-manager
----

The gatekeeper webhook certificate is rotated. 

//If we want to keep the previous statement^, we must provide a verification step for the user to conform that the cert was rotated successfully | MJ | 07/13/23

[#list-hub-cluster-managed-certificates]
== Listing hub cluster managed certificates

You can view a list of hub cluster managed certificates that use OpenShift Service Serving Certificates service internally. Run the following command to list the certificates: 

[source,bash]
----
for ns in multicluster-engine open-cluster-management ; do echo "$ns:" ; oc get secret -n $ns -o custom-columns=Name:.metadata.name,Expiration:.metadata.annotations.service\\.beta\\.openshift\\.io/expiry | grep -v '<none>' ; echo ""; done
----

For more information, see _OpenShift Service Serving Certificates_ in the _Additional resources_ section.

*Note:* If observability is enabled, there are additional namespaces where certificates are created.

[additional-resource-cert-manage]
== Additional resources

- link:https://docs.openshift.com/container-platform/4.11/security/certificates/service-serving-certificate.html[OpenShift Service Serving Certificates]
- xref:../governance/cert_manage_overview.adoc#cert-manage-overview[Managing certificates overview]
- Return to the beginning of this page, <<cert-manage,Managing certificates>>.
